#!/usr/bin/env node
'use strict';

var chunkZJJTBDKO_cjs = require('./chunk-ZJJTBDKO.cjs');
var path = require('path');
var v = require('lodash');
var A = require('didyoumean');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var v__default = /*#__PURE__*/_interopDefault(v);
var A__default = /*#__PURE__*/_interopDefault(A);

var c=Symbol("root"),F=Symbol("skip"),_=["version","help"];var G=(e,t)=>{if(e==null||!Array.isArray(e))throw "args should be array";let n=e.slice();switch(t){case"electron":return process.defaultApp?n.slice(2):n.slice(1);case"user":return n;default:return n.slice(2)}};A__default.default.threshold=.5;var H=(e,t,n)=>{let a=G(e.args,e.from);return new Promise((s,r)=>{let{command:i,usageOptions:p,error:m}=D(t,a);if(m){r(new Error(m));return}!p.length&&i.name===c&&p.push(i.options.find(u=>u.flags.name==="help"));let l=p.filter(u=>u.operation);if(l.length){l[0].operation(),s({command:F,options:{}});return}else {let u="",g=(d,f)=>{if(d){let h=d.$data;if(!h.length&&!f.flags.value)return !f.flags.isNoFlag;if(f.flags.value)return f.flags.value.variadic?h.reduce((b,y)=>(b.push(...y.split(",").map(f.flags.value.formatter)),b),[]):f.flags.value.formatter(h[0]||f.default)}return f.default},$=i.options.reduce((d,f)=>{if(u)return d;let h=p.find(y=>y.flags.name===f.flags.name);if(!h&&f.required)return u=`required option '${f.flags.raw}' not specified`,d;let b=g(h,f);if(!f.operation){let y=f.internal||{};d[y.name||f.flags.name]=y.formatter?y.formatter(b):b;}return d},{});u?r(new Error(u)):s({command:i.name===c?null:i.name,options:$});}})},D=(e,t)=>{let n=null,a=[],s=null,r="",i=[];return v__default.default.forEach(t,(p,m)=>{if(!r){if(m===0){if(n=e[p],!n&&!p.startsWith("-")){let l=A__default.default(p,v__default.default.keys(e));r=`unknown command ${p}${l?`
(Did you mean ${l} ?)`:""}`;}else n||(n=e[c]);n&&(i=n.options.reduce((l,u)=>[...l,...u.flags.keys],[]));}if(!r){if(p.startsWith("-")){let l=n.options.find(u=>u.flags.keys.includes(p));if(!l){let u=A__default.default(p,i);r=`unknown option ${p}${u?`
(Did you mean ${u} ?)`:""}`;}if(l){if(s&&s.flags.name===l.flags.name)return;let u=a.find(g=>g.flags.name===l.flags.name);u?s=u:(s={...l,$data:[]},a.push(s));}return}s&&s.$data.push(p);}}}),n=n||e[c],r?{command:null,usageOptions:[],error:r}:{command:n,usageOptions:a,error:r}};var B=e=>e.reduce((t,n)=>{let a=`${n.flags.keys.join(", ")}${n.flags.value?.raw?` ${n.flags.value?.raw}`:""}`,s=`${n.description||""}${n.default===void 0||n.flags.isNoFlag&&n.default===!0?"":` (default: ${typeof n.default=="string"?`"${n.default}"`:n.default})`}`;return a.length>t.maxLength&&(t.maxLength=a.length),t.options.push({flags:a,description:s}),t},{options:[],maxLength:0}),S=(e,t,n)=>e.map(a=>{let r=`${Array(n).fill(" ").join("")}${a.flags.padEnd(t," ")}  `,i=Array(r.length).fill(" ").join(""),p=a.description.split(`
`);return r+p.map((m,l)=>l===0?m:`
${i}${m}`).join("")}).join(`
`),J=(e,t)=>{let{options:n,maxLength:a}=B(e[c].options),{commands:s,maxLength:r}=v__default.default.filter(e,l=>l.name!==c).reduce((l,u)=>{let g=B(u.options),$=`${u.name}${g.length?" [options]":""}`,d=u.description,f=Math.max($.length,g.maxLength);return f>l.maxLength&&(l.maxLength=f),l.commands.push({description:d,name:$,options:g}),l},{commands:[],maxLength:a}),i=S(n,a,2),p=s.map(l=>{let u=`  ${l.name.padEnd(r," ")}    `,g=Array(u.length).fill(" ").join(""),$=l.description.split(`
`),d=S(l.options.options,r,4);return u+$.map((f,h)=>h===0?f:`
${g}${f}`).join("")+(d.length?`
${d}`:"")}).join(`
`),m=[i&&`Options:
${i}`,p&&`Commands:
${p}`].filter(Boolean).join(`

`);console.log(`Usage: ${[t.input.name,t.input.alias].filter(Boolean).join("|")}${i?" [options]":""}${p?" [command]":""}
${t.input.description&&`
${t.input.description}`}

${m}`);},R=(e,t,n)=>{if(n.name===c)return J(e,t);let{options:a,maxLength:s}=B(n.options),r=S(a,s,2),i=[r&&`Options:
${r}`].filter(Boolean).join(`

`);console.log(`Usage: ${t.input.name} ${n.name}${r?" [options]":""}
${n.description&&`
${n.description}`}

${i}`);};var L=e=>{console.log(e.input.version);};var I={number:e=>+e,numeric:e=>+e,str:e=>`${e}`,string:e=>`${e}`,bool:e=>!!e,boolean:e=>!!e},M=e=>{let t=null,n=[],a=null,s=e.includes("--no-");v__default.default.compact(v__default.default.split(e," ").map(i=>i.replace(/,/g,""))).forEach(i=>{if(i.startsWith("-"))n.push(i);else if(a===null&&(i.startsWith("{")||i.startsWith("[")||i.startsWith("<"))){let p=i.replace(/[{[<>}\].]/g,""),m=i.includes("...");a={raw:i,variadic:m,name:p,formatter:I[p]||I.string};}});let r=n.slice().sort((i,p)=>p.length-i.length)[0];return v__default.default.isEmpty(r)||(t=v__default.default.camelCase((s?r.replace("--no-",""):r).replace(/(--?)/,""))),{isNoFlag:s,raw:e,name:t,keys:n,value:a}},x=e=>{let t=M(e.flags);return t.name?{required:!!e.required,description:`${e.description||""}`,default:e.default,flags:t,operation:e.operation,internal:e.internal}:(console.warn("invalid option",e),null)};var W=e=>{let t={},n=(s,{addVersion:r=!1,addHelp:i=!0}={})=>(t[s.name]={name:s.name,description:`${s.description||""}`,options:v__default.default.compact(v__default.default.map(s.options,x))},r&&t[s.name].options.unshift(x({flags:"-v, --version",description:"output the current version",operation:()=>L(a)})),i&&t[s.name].options.push(x({flags:"-h, --help",description:"display help for command",operation:()=>R(t,a,t[s.name])})),a),a={commands:t,input:e,addCommand:n,execute:s=>H(s,t)};return n({name:c,options:[]},{addVersion:!1,addHelp:!1}),v__default.default.forEach(e.options,s=>{let r=x(s);if(r){if(_.includes(r.name)){console.warn("reserved option",r.name);return}t[c].options.push(r);}}),t[c].options.unshift(x({flags:"-v, --version",description:"output the current version",operation:()=>L(a)})),t[c].options.push(x({flags:"-h, --help",description:"display help for command",operation:()=>R(t,a,t[c])})),v__default.default.forEach(e.commands,n),a};var o=new chunkZJJTBDKO_cjs.d({}),w=new chunkZJJTBDKO_cjs.e({}),V=W({name:chunkZJJTBDKO_cjs.a.name,alias:"sta",version:chunkZJJTBDKO_cjs.a.version,description:`Generate api via swagger scheme.
Supports OA 3.0, 2.0, JSON, yaml.`,options:[{flags:"-p, --path <string>",description:"path/url to swagger scheme",required:!0},{flags:"-o, --output <string>",description:"output path of typescript api file",default:"./"},{flags:"-n, --name <string>",description:"name of output typescript api file",default:o.fileName},{flags:"-t, --templates <string>",description:"path to folder containing templates"},{flags:"-d, --default-as-success",description:`use "default" response status code as success response too.
some swagger schemas use "default" response status code as success response type by default.`,default:o.defaultResponseAsSuccess,internal:{name:"defaultResponseAsSuccess"}},{flags:"-r, --responses",description:`generate additional information about request responses
also add typings for bad responses`,default:o.generateResponses,internal:{name:"generateResponses"}},{flags:"--union-enums",description:'generate all "enum" types as union types (T1 | T2 | TN)',default:o.generateUnionEnums,internal:{name:"generateUnionEnums"}},{flags:"--add-readonly",description:"generate readonly properties",default:o.addReadonly},{flags:"--route-types",description:"generate type definitions for API routes",default:o.generateRouteTypes,internal:{name:"generateRouteTypes"}},{flags:"--no-client",description:"do not generate an API class",default:o.generateClient},{flags:"--enum-names-as-values",description:"use values in 'x-enumNames' as enum values (not only as keys)",default:o.enumNamesAsValues},{flags:"--extract-request-params",description:"extract request params to data contract (Also combine path params and query params into one object)",default:o.extractRequestParams,internal:{formatter:Boolean}},{flags:"--extract-request-body",description:"extract request body type to data contract",default:o.extractRequestBody,internal:{formatter:Boolean}},{flags:"--extract-response-body",description:"extract response body type to data contract",default:o.extractResponseBody,internal:{formatter:Boolean}},{flags:"--extract-response-error",description:"extract response error type to data contract",default:o.extractResponseError,internal:{formatter:Boolean}},{flags:"--extract-responses",description:"extract all responses described in /components/responses",default:o.extractResponses,internal:{formatter:Boolean}},{flags:"--modular",description:"generate separated files for http client, data contracts, and routes",default:o.modular,internal:{formatter:Boolean}},{flags:"--js",description:"generate js api module with declaration file",default:o.toJS,internal:{formatter:Boolean,name:"toJS"}},{flags:"--module-name-index <number>",description:"determines which path index should be used for routes separation (example: GET:/fruits/getFruit -> index:0 -> moduleName -> fruits)",default:o.moduleNameIndex,internal:{formatter:e=>+e||0}},{flags:"--module-name-first-tag",description:"splits routes based on the first tag",default:o.moduleNameFirstTag},{flags:"--disableStrictSSL",description:"disabled strict SSL",default:o.disableStrictSSL,internal:{formatter:Boolean}},{flags:"--disableProxy",description:"disabled proxy",default:o.disableProxy,internal:{formatter:Boolean}},{flags:"--axios",description:"generate axios http client",default:o.httpClientType===chunkZJJTBDKO_cjs.b.AXIOS},{flags:"--unwrap-response-data",description:"unwrap the data item from the response",default:o.unwrapResponseData},{flags:"--disable-throw-on-error",description:"Do not throw an error when response.ok is not true",default:o.disableThrowOnError},{flags:"--single-http-client",description:"Ability to send HttpClient instance to Api constructor",default:o.singleHttpClient,internal:{formatter:Boolean}},{flags:"--silent",description:"Output only errors to console",default:o.silent,internal:{formatter:Boolean}},{flags:"--default-response <type>",description:"default type for empty response schema",default:o.defaultResponseType,internal:{name:"defaultResponseType"}},{flags:"--type-prefix <string>",description:"data contract name prefix",default:o.typePrefix},{flags:"--type-suffix <string>",description:"data contract name suffix",default:o.typeSuffix},{flags:"--clean-output",description:"clean output folder before generate api. WARNING: May cause data loss",default:o.cleanOutput,internal:{formatter:Boolean}},{flags:"--api-class-name <string>",description:"name of the api class",default:o.apiClassName},{flags:"--patch",description:"fix up small errors in the swagger source definition",default:o.patch,internal:{formatter:Boolean}},{flags:"--debug",description:"additional information about processes inside this tool",default:o.debug},{flags:"--another-array-type",description:"generate array types as Array<Type> (by default Type[])",default:o.anotherArrayType},{flags:"--sort-types",description:"sort fields and types",default:o.sortTypes},{flags:"--extract-enums",description:"extract all enums from inline interface\\type content to typescript enum construction",default:o.extractEnums},{flags:"--sort-routes",description:"sort routes in alphabetical order",default:o.sortRoutes},{flags:"--custom-config <string>",description:"custom config: primitiveTypeConstructs, hooks, ... ",default:""}]});V.addCommand({name:"generate-templates",description:'Generate ".ejs" templates needed for generate api',options:[{flags:"-o, --output <string>",description:"output path of generated templates",default:w.output},{flags:"-m, --modular",description:"generate templates needed to separate files for http client, data contracts, and routes",default:w.modular,internal:{formatter:Boolean}},{flags:"--http-client <string>",description:`http client type (possible values: ${Object.values(chunkZJJTBDKO_cjs.b).map(e=>`"${e}"`).join(", ")})`,default:w.httpClientType,internal:{name:"httpClientType"}},{flags:"-c, --clean-output",description:"clean output folder before generate template. WARNING: May cause data loss",default:w.cleanOutput,internal:{formatter:Boolean}},{flags:"-r, --rewrite",description:"rewrite content in existing templates",default:w.rewrite,internal:{formatter:Boolean}},{flags:"--silent",description:"Output only errors to console",default:w.silent,internal:{formatter:Boolean}}]});var K=async()=>{let{command:e,options:t}=await V.execute({args:process.argv}),n=null,a;if(t.customConfig){try{a=path.resolve(process.cwd(),t.customConfig),n=await import(a),n=n.default||n;}catch(s){console.error("Error loading custom config",s);}n&&console.log(`\u2728 found custom config at: ${a}`);}try{switch(e){case null:{await chunkZJJTBDKO_cjs.g({...t,name:t.name,url:t.path,generateRouteTypes:t.generateRouteTypes,generateClient:!!(t.axios||t.client),httpClientType:t.axios?chunkZJJTBDKO_cjs.b.AXIOS:chunkZJJTBDKO_cjs.b.FETCH,input:path.resolve(process.cwd(),t.path),output:path.resolve(process.cwd(),t.output||"."),...n});break}case"generate-templates":{await chunkZJJTBDKO_cjs.f(t);break}default:break}}catch(s){console.error(s),process.exit(1);}process.exit(0);};K();
//# sourceMappingURL=cli.cjs.map
//# sourceMappingURL=cli.cjs.map